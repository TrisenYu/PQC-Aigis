name: encapsulation and signature test-ci/cd.
on: [push]

jobs:
  normal-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        cc: ["clang", "gcc"]
        kdf_conf: [0, 1]
        param_conf: [1, 2, 3]
      max-parallel: 4

    steps:
      - name: 切分支
        uses: actions/checkout@main
        env:
          ccompiler: ${{ matrix.cc }}
      - name: 下依赖
        run: |
          if [ "$ccompiler" == "clang" ]; then
            sudo apt install clang
          fi

      - name: compile-and-test
        env:
          aigis_param: ${{ matrix.param_conf }}
          kdf: ${{ matrix.kdf_conf }}
          ccompiler: ${{ matrix.cc }}
        run: |
          mkdir -p build && cd build
          cmake \
          -DAIGIS_PARAM_CONF=$aigis_param \
          -DAIGIS_KDF_CONF=$kdf \
          -DCMAKE_C_COMPILER=$ccompiler ..
          make run
          echo 'done...'
